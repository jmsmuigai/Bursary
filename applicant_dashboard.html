<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Track your Garissa County Bursary Application" />
  <title>Garissa MBMS • Applicant Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body class="bg-app">
  <nav class="navbar navbar-expand-lg navbar-dark" style="background:var(--primary-700);">
    <div class="container">
      <a class="navbar-brand" href="#">
        <img src="Garissa Logo.png" alt="" class="logo-circle me-2" style="width:40px;height:40px;" onerror="this.style.display='none'"/>
        Garissa MBMS
      </a>
      <div class="ms-auto">
        <a href="help.html" class="btn btn-outline-light btn-sm me-2" target="_blank">
          <i class="bi bi-question-circle me-1"></i>Help
        </a>
        <span class="text-white me-3" id="userName">Applicant</span>
        <a href="index.html" class="btn btn-outline-light btn-sm">
          <i class="bi bi-box-arrow-right me-1"></i>Logout
        </a>
      </div>
    </div>
  </nav>

  <div class="container py-4">
    <div class="row mb-4">
      <div class="col-md-12">
        <h3 class="text-primary-700 fw-bold">My Application Dashboard</h3>
        <p class="text-muted">Track your bursary application status</p>
      </div>
    </div>

    <div class="row g-4 mb-4">
      <div class="col-md-4">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-body">
            <div class="d-flex align-items-center">
              <i class="bi bi-file-earmark-text fs-1 text-primary-700 me-3"></i>
              <div>
                <h5 class="mb-0" id="appStatus">No Application</h5>
                <small class="text-muted">Application Status</small>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-body">
            <div class="d-flex align-items-center">
              <i class="bi bi-calendar-check fs-1 text-info me-3"></i>
              <div>
                <h5 class="mb-0" id="appDate">-</h5>
                <small class="text-muted">Date Submitted</small>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-body">
            <div class="d-flex align-items-center">
              <i class="bi bi-cash-coin fs-1 text-success me-3"></i>
              <div>
                <h5 class="mb-0" id="appAmount">-</h5>
                <small class="text-muted">Amount Requested</small>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="card border-0 shadow-lg">
      <div class="card-header bg-light">
        <h5 class="mb-0"><i class="bi bi-list-ul me-2"></i>My Application</h5>
      </div>
      <div class="card-body">
        <div id="applicationContent">
          <div class="text-center py-5">
            <i class="bi bi-file-earmark-plus fs-1 text-muted mb-3"></i>
            <h5>No Application Found</h5>
            <p class="text-muted">You haven't submitted an application yet.</p>
            <a href="application.html" class="btn btn-primary-700">
              <i class="bi bi-plus-circle me-2"></i>Start New Application
            </a>
          </div>
        </div>
      </div>
    </div>

    <div class="card border-0 shadow-sm mt-4" id="draftCard" style="display:none;">
      <div class="card-header bg-warning text-dark">
        <h5 class="mb-0"><i class="bi bi-file-earmark-dash me-2"></i>Incomplete Application (Draft)</h5>
      </div>
      <div class="card-body">
        <p>You have an incomplete application. You can continue filling it now.</p>
        <a href="application.html" class="btn btn-warning">
          <i class="bi bi-pencil me-2"></i>Continue Application
        </a>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="js/data.js"></script>
  <script>
    // Get current user
    const userStr = sessionStorage.getItem('mbms_current_user');
    if (!userStr) {
      alert('Please login to access your dashboard.');
      window.location.href = 'index.html';
    }

    const user = JSON.parse(userStr);
    document.getElementById('userName').textContent = `${user.firstName} ${user.lastName}`;

    // Load user's application
    const applications = JSON.parse(localStorage.getItem('mbms_applications') || '[]');
    const userApp = applications.find(app => app.applicantEmail === user.email);

    // Check for draft
    const draftKey = `mbms_application_${user.email}`;
    const draft = localStorage.getItem(draftKey);
    if (draft) {
      document.getElementById('draftCard').style.display = 'block';
    }

    if (userApp) {
      // Display application details
      document.getElementById('appStatus').textContent = userApp.status;
      document.getElementById('appDate').textContent = new Date(userApp.dateSubmitted).toLocaleDateString();
      document.getElementById('appAmount').textContent = `Ksh ${userApp.financialDetails.amountRequested.toLocaleString()}`;

      const content = document.getElementById('applicationContent');
      content.innerHTML = `
        <div class="row">
          <div class="col-md-6">
            <h6 class="text-primary-700">Application ID</h6>
            <p>${userApp.appID}</p>
          </div>
          <div class="col-md-6">
            <h6 class="text-primary-700">Status</h6>
            <span class="badge bg-${getStatusColor(userApp.status)}">${userApp.status}</span>
          </div>
          <div class="col-md-6">
            <h6 class="text-primary-700">Institution</h6>
            <p>${userApp.personalDetails.institution}</p>
          </div>
          <div class="col-md-6">
            <h6 class="text-primary-700">Registration Number</h6>
            <p>${userApp.personalDetails.regNumber}</p>
          </div>
          <div class="col-md-6">
            <h6 class="text-primary-700">Fee Balance</h6>
            <p>Ksh ${userApp.financialDetails.feeBalance.toLocaleString()}</p>
          </div>
          <div class="col-md-6">
            <h6 class="text-primary-700">Amount Requested</h6>
            <p>Ksh ${userApp.financialDetails.amountRequested.toLocaleString()}</p>
          </div>
        </div>
        <hr>
        <div class="text-center">
          <button class="btn btn-outline-primary" onclick="window.print()">
            <i class="bi bi-printer me-2"></i>Print Application
          </button>
        </div>
      `;
    } else {
      // Show start application button
      const content = document.getElementById('applicationContent');
      content.innerHTML = `
        <div class="text-center py-5">
          <i class="bi bi-file-earmark-plus fs-1 text-muted mb-3"></i>
          <h5>No Application Found</h5>
          <p class="text-muted">You haven't submitted an application yet.</p>
          <a href="application.html" class="btn btn-primary-700">
            <i class="bi bi-plus-circle me-2"></i>Start New Application
          </a>
        </div>
      `;
    }

    function getStatusColor(status) {
      const colors = {
        'Pending Submission': 'warning',
        'Pending Ward Review': 'info',
        'Pending Committee Review': 'primary',
        'Awarded': 'success',
        'Rejected': 'danger'
      };
      return colors[status] || 'secondary';
    }
  </script>
  
  <!-- Footer -->
  <footer class="mt-5 py-4" style="background: linear-gradient(135deg, var(--primary-700) 0%, var(--primary-600) 100%); color: white;">
    <div class="container">
      <div class="text-center">
        <p class="mb-2" style="font-size: 0.9rem;">
          <span style="color: #FFD700; font-weight: bold;">Garissa County Bursary Management System v2.0</span>
        </p>
        <p class="mb-0" style="font-size: 0.85rem; opacity: 0.9;">
          System developed by <a href="mailto:jmsmuigai@gmail.com" style="color: #FFD700; text-decoration: none; font-weight: bold;">jmsmuigai@gmail.com</a>
        </p>
        <p class="mt-2 mb-0" style="font-size: 0.75rem; opacity: 0.8;">
          © 2025 Garissa County Government. All rights reserved.
        </p>
      </div>
    </div>
  </footer>
</body>
</html>

