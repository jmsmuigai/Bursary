<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Garissa MBMS • Register</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body class="bg-app">
  <div class="container py-4 py-md-5">
    <div class="row justify-content-center">
      <div class="col-lg-10">
        <div class="card border-0 shadow-lg rounded-4">
          <div class="card-body p-4 p-md-5">
            <div class="text-center mb-4">
              <img src="Garissa Logo.png" alt="" class="logo-circle mb-2" onerror="this.style.display='none'"/>
              <h3 class="text-primary-700 fw-bold mb-1">Applicant Account Registration</h3>
              <div class="text-muted small">Create an account to apply for the county bursary</div>
            </div>

            <form id="applicantRegistrationForm" class="row g-3 needs-validation" novalidate>
              <h5 class="mt-2">Personal & Contact</h5>
              <div class="col-md-4">
                <label class="form-label">Surname *</label>
                <input id="lastName" class="form-control" required />
              </div>
              <div class="col-md-4">
                <label class="form-label">First Name *</label>
                <input id="firstName" class="form-control" required />
              </div>
              <div class="col-md-4">
                <label class="form-label">Other Name(s)</label>
                <input id="otherName" class="form-control" />
              </div>
              <div class="col-md-6">
                <label class="form-label">Email Address *</label>
                <input id="emailAddress" type="email" class="form-control" required />
              </div>
              <div class="col-md-6">
                <label class="form-label">NEMIS / National ID No. *</label>
                <input id="nemisId" class="form-control" required />
              </div>

              <h5 class="mt-3">Home Location (Garissa)</h5>
              <div class="col-md-6">
                <label class="form-label">Home Sub-County *</label>
                <select id="subCounty" class="form-select" required></select>
              </div>
              <div class="col-md-6" id="otherSubCountyDiv" style="display:none;">
                <label class="form-label">Specify Sub-County</label>
                <input id="otherSubCounty" class="form-control" />
              </div>
              <div class="col-md-6">
                <label class="form-label">Home Ward *</label>
                <select id="ward" class="form-select" required disabled>
                  <option value="">-- Select Ward --</option>
                </select>
              </div>
              <div class="col-md-6" id="otherWardDiv" style="display:none;">
                <label class="form-label">Specify Ward</label>
                <input id="otherWard" class="form-control" />
              </div>

              <h5 class="mt-3">Security</h5>
              <div class="col-md-6">
                <label class="form-label">Password *</label>
                <input id="password" type="password" class="form-control" required />
              </div>
              <div class="col-md-6">
                <label class="form-label">Confirm Password *</label>
                <input id="confirmPassword" type="password" class="form-control" required />
                <div class="invalid-feedback" id="passwordMatchFeedback">Passwords do not match.</div>
              </div>
              <div class="col-12 mt-2">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="robotCheck" required />
                  <label class="form-check-label" for="robotCheck">I'm not a robot</label>
                </div>
              </div>
              <div class="col-12">
                <button class="btn btn-primary-700 w-100 py-2" type="submit">Register Account</button>
              </div>
              <div class="col-12 text-center">
                <a href="index.html" class="link-primary-700 text-decoration-none small">Already have an account? Login →</a>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="js/data.js"></script>
  <script>
    const subCountySelect = document.getElementById('subCounty');
    const wardSelect = document.getElementById('ward');
    const otherSubCountyDiv = document.getElementById('otherSubCountyDiv');
    const otherWardDiv = document.getElementById('otherWardDiv');
    const otherSubCountyInput = document.getElementById('otherSubCounty');
    const otherWardInput = document.getElementById('otherWard');

    // Populate subcounties
    subCountySelect.innerHTML = '<option value="">-- Select Sub-County --</option>';
    Object.keys(GARISSA_WARDS).forEach(sc=>{
      const opt = new Option(sc, sc);
      subCountySelect.add(opt);
    });
    subCountySelect.add(new Option('Other (Specify below)', 'other_subcounty'));

    function populateWards(){
      wardSelect.innerHTML = '<option value="">-- Select Ward --</option>';
      wardSelect.disabled = true;
      otherSubCountyDiv.style.display = 'none';
      otherWardDiv.style.display = 'none';
      otherSubCountyInput.removeAttribute('required');
      otherWardInput.removeAttribute('required');

      const sc = subCountySelect.value;
      if(sc === 'other_subcounty'){
        otherSubCountyDiv.style.display = 'block';
        otherSubCountyInput.setAttribute('required','required');
        return;
      }
      const wards = GARISSA_WARDS[sc] || [];
      wards.forEach(w => wardSelect.add(new Option(w, w)));
      wardSelect.add(new Option('Other (Specify below)', 'other_ward'));
      wardSelect.disabled = false;
    }
    subCountySelect.addEventListener('change', populateWards);
    wardSelect.addEventListener('change', ()=> {
      if(wardSelect.value === 'other_ward'){
        otherWardDiv.style.display = 'block';
        otherWardInput.setAttribute('required','required');
      }else{
        otherWardDiv.style.display = 'none';
        otherWardInput.removeAttribute('required');
      }
    });
    populateWards();

    document.getElementById('applicantRegistrationForm').addEventListener('submit', (e)=>{
      e.preventDefault();
      const pwd = document.getElementById('password').value;
      const cpwd = document.getElementById('confirmPassword').value;
      if(pwd !== cpwd){
        document.getElementById('passwordMatchFeedback').style.display='block';
        document.getElementById('confirmPassword').classList.add('is-invalid');
        return;
      }
      const payload = {
        firstName: document.getElementById('firstName').value.trim(),
        lastName: document.getElementById('lastName').value.trim(),
        otherName: document.getElementById('otherName').value.trim(),
        email: document.getElementById('emailAddress').value.trim(),
        nemisId: document.getElementById('nemisId').value.trim(),
        subCounty: subCountySelect.value === 'other_subcounty' ? otherSubCountyInput.value.trim() : subCountySelect.value,
        ward: wardSelect.value === 'other_ward' ? otherWardInput.value.trim() : wardSelect.value,
        role: 'applicant',
        createdAt: new Date().toISOString()
      };
      // Local demo registration (replace with Firebase Auth later)
      const users = JSON.parse(localStorage.getItem('mbms_users')||'[]');
      users.push(payload);
      localStorage.setItem('mbms_users', JSON.stringify(users));
      alert('Registration successful (demo). Proceed to login.');
      window.location.href = 'index.html';
    });
  </script>
</body>
<\/html>

